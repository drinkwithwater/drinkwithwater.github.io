require=function t(e,n,i){function r(l,o){if(!n[l]){if(!e[l]){var s="function"==typeof require&&require;if(!o&&s)return s(l,!0);if(a)return a(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[l]={exports:{}};e[l][0].call(c.exports,function(t){var n=e[l][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[l].exports}for(var a="function"==typeof require&&require,l=0;l<i.length;l++)r(i[l]);return r}({BasePoint:[function(t,e,n){"use strict";cc._RFpush(e,"d3651454lxMuqeKmoT9tczu","BasePoint");var i=t("CellManager"),r=t("riddleUtil");cc.Class({"extends":cc.Component,properties:{cell:{visible:!1,"default":cc.p(0,0)},point:{visible:!1,"default":cc.p(0,0)},cellManager:{type:i,visible:!1,"default":null}},initByNode:function(t,e,n){console.log("error:initByNode is not implemented")},changeCell:function(t,e){console.log("error:changeCell is not implemented")},updatePosition:function(){var t=this.cellManager.pointToPositionAR(this.point);this.node.attr({x:t.x,y:t.y})},updateCell:function(){var t=this.cellManager.pointToCell(this.point),e=this.cell;e.x==t.x&&e.y==t.y||this.changeCell(e,t),this.cell=t,this.updatePosition()},cellFarFrom:function(t){return r.maDistance(this.cell,t)},pointFarFrom:function(t){return r.maDistance(this.point,t)}}),cc._RFpop()},{CellManager:"CellManager",riddleUtil:"riddleUtil"}],BattleFieldComponent:[function(t,e,n){"use strict";cc._RFpush(e,"15afeFzYbRILKPnZedkuVb6","BattleFieldComponent");var i=t("riddleUtil"),r=t("CellManager"),a=t("UnitManager"),l=t("BulletManager"),o=t("UnitConfigManager"),s=t("DrawLayer");cc.Class({"extends":cc.Component,properties:{gameCtrl:null,tiledMap:{type:cc.TiledMap,"default":null},cellManager:{type:r,"default":null},unitManager:{type:a,"default":null},unitConfigManager:{type:o,"default":null},bulletManager:{type:l,"default":null},drawLayer:{type:s,"default":null},timeSum:{visible:!1,"default":0}},loadMapByUrl:function(t){var e=this;cc.loader.loadRes(t,cc.TiledMapAsset,function(t,n){t&&console.log(t),e.tiledMap.tmxAsset=n,e.loadMap()})},onLoad:function(){},riddleTestBind:function(){i.test.battleNode=this.node,i.test.unitConfigLayer=this.node.getChildByName("mapLayer").getComponent("cc.TiledMap"),i.test.cellManager=this.cellManager,i.test.unitManager=this.unitManager,i.test.bulletManager=this.bulletManager,i.test.unitConfig=this.node.getChildByName("mapLayer").getComponent("UnitConfigManager"),i.test.drawLayer=this.drawLayer},loadMap:function(){this.cellManager.initByNode(this),this.bulletManager.initByNode(this),this.unitConfigManager.initByNode(this),this.unitManager.initByNode(this),this.drawLayer.initByNode(this),this.riddleTestBind()},update:function(t){this.timeSum+=t,this.timeSum>1&&(this.timeSum-=1)},gameWin:function(){this.gameCtrl&&this.gameCtrl.win()}}),cc._RFpop()},{BulletManager:"BulletManager",CellManager:"CellManager",DrawLayer:"DrawLayer",UnitConfigManager:"UnitConfigManager",UnitManager:"UnitManager",riddleUtil:"riddleUtil"}],BulletBase:[function(t,e,n){"use strict";cc._RFpush(e,"9c8f8vCFIhKI5VYwwhk/ZuI","BulletBase");var i=(t("FlyPoint"),t("UnitManager")),r=t("CellManager");t("underscore");cc.Class({"extends":cc.Component,properties:{bulletId:-1,sourceInter:null,targetInter:null,startPoint:null,flyPoint:{visible:!1,get:function(){return this.getComponent("FlyPoint")}},unitManager:i,cellManager:r,bulletManager:null,harm:0,distance:0,died:!1},actionExplode:function(t){var e=this.node;e.runAction(cc.sequence(cc.scaleTo(.1,2,2),cc.callFunc(t)))},initByBulletManager:function(t,e,n){this.cellManager=t.cellManager,this.unitManager=t.unitManager,this.bulletManager=t,this.bulletId=e,this.sourceInter=n.sourceInter,this.targetInter=n.targetInter,this.harm=n.harm,this.distance=n.distance,this.startPoint=n.point,this.flyPoint.initByNode(this,n.point)}}),cc._RFpop()},{CellManager:"CellManager",FlyPoint:"FlyPoint",UnitManager:"UnitManager",underscore:1}],BulletManager:[function(t,e,n){"use strict";cc._RFpush(e,"30ace3TcvdIQqhi9I9XP2LZ","BulletManager");t("riddleUtil");cc.Class({"extends":cc.Component,properties:{bulletTemplate:cc.Prefab,straightBulletTemplate:cc.Prefab,trackBulletTemplate:cc.Prefab,delBullet:{type:cc.NodePool,visible:!1,"default":null},cellManager:{visible:!1,"default":null},unitManager:{visible:!1,"default":null},drawLayer:{visible:!1,"default":null},idCounter:1,idToBullet:{visible:!1,"default":null}},onLoad:function(){},initByNode:function(t){this.idToBullet={},this.cellManager=t.cellManager,this.unitManager=t.unitManager,this.drawLayer=t.drawLayer},skillCreateBullet:function(t,e){var n=cc.instantiate(this.bulletTemplate),i=this.idCounter++;return n.getComponent("BulletBase").initByBulletManager(this,t.getComponent("SlidePoint").point,i,e),this.idToBullet[i]=n,this.node.addChild(n,0,i),n},skillCreateTrackBullet:function(t){var e=cc.instantiate(this.trackBulletTemplate),n=this.idCounter++;return e.getComponent("TrackBullet").initByBulletManager(this,n,t),this.idToBullet[n]=e,this.node.addChild(e,0,n),e},skillCreateStraightBullet:function(t){var e=cc.instantiate(this.straightBulletTemplate),n=this.idCounter++;return e.getComponent("StraightBullet").initByBulletManager(this,n,t),this.idToBullet[n]=e,this.node.addChild(e,0,n),e},skillAttackNoBullet:function(t){var e=t.sourceInter.getPoint(),n=t.targetInter.getPoint();t.targetInter.onHurtByHit(t.sourceInter,t.harm),this.drawLayer.animateAttack(e,n)},removeBullet:function(t){var e=this.idToBullet[t];delete this.idToBullet[t],e.removeFromParent()}}),cc._RFpop()},{riddleUtil:"riddleUtil"}],CellManager:[function(t,e,n){"use strict";cc._RFpush(e,"cb434d3JUBGV4dfpdP+97FP","CellManager");var i=t("underscore");cc.Class({"extends":cc.Component,properties:{tiledLayerName:"cellItem",tiledMapAdapter:{visible:!1,get:function(){return this.getComponent("TiledMapAdapter")}},cellRange:{visible:!1,"default":cc.p(0,0)},cellSize:10,tileSize:0,unitManager:{visible:!1,"default":null}},onLoad:function(){},initByNode:function(t){this.unitManager=t.unitManager,this.cellRange=this.tiledMapAdapter.tileRange,this.tileSize=this.tiledMapAdapter.tileSize.x},canMove:function(t){var e=this.cellRange;if(t.x<0||t.x>=e.x)return!1;if(t.y<0||t.y>=e.y)return!1;var n=this.getItemAt(t);if(n)return!1;var r=this.unitManager.unit$(t);return!i.isObject(r)},isItem:function(t){var e=this.getItemAt(t);return!!e},getItemAt:function(t){var e=this.tiledMapAdapter.getLayerPropertiesAt(this.tiledLayerName,t);return i.isObject(e)&&i.has(e,"item")?e.item:null},pointToCell:function(t){return cc.p(Math.floor(t.x/this.cellSize),Math.floor(t.y/this.cellSize))},cellToPoint:function(t){var e=this.cellSize,n=this.cellSize;return cc.p((t.x+.5)*e,(t.y+.5)*n)},cellToPositionAR:function(t){var e=this.tiledMapAdapter.tileSize,n=this.centerPositionAR();return cc.p((t.x+.5)*e.x-n.x,(t.y+.5)*e.y-n.y)},cellToPosition:function(){},positionToCell:function(t){var e=this.tiledMapAdapter.tileSize,n=cc.p(Math.floor(t.x/e.x),Math.floor(t.y/e.y));return n},positionToPoint:function(){},pointToPositionAR:function(t){var e=this.tiledMapAdapter.tileSize,n=this.cellSize,i=this.centerPositionAR();return cc.p(t.x*e.x/n-i.x,t.y*e.y/n-i.y)},centerPositionAR:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),n=t.width*e.x,i=t.height*e.y;return{x:n,y:i}}}),cc._RFpop()},{underscore:1}],CnText:[function(t,e,n){"use strict";cc._RFpush(e,"8eb7fSPNthKO79IJCz8j4w5","CnText"),cc.Class({"extends":cc.Component,properties:{missionComplete:{"default":""},nextMap:{"default":""},noNextMap:{"default":""},missionInfo:[cc.String]}}),cc._RFpop()},{}],DrawItem:[function(t,e,n){"use strict";cc._RFpush(e,"649a2IOAfFM4LXBOG6UUGr1","DrawItem");var i=cc.color(255,0,0,1),r=cc.color(255,0,0,100);cc.Class({"extends":cc.Component,properties:{drawNode:{visible:!1,type:cc.DrawNode,"default":null},init:!1,unitBase:{get:function(){return this.getComponent("UnitBase")}}},getDrawNode:function(){return this.init||(this.drawNode=new cc.DrawNode,this.node._sgNode.addChild(this.drawNode),this.init=!0),this.drawNode},showObserve:function(){var t=this.getDrawNode(),e=this.unitBase.cellManager.tileSize*this.getComponent("UnitAttributes").observeRange,n=cc.p(0,e),a=cc.p(e,0),l=cc.p(0,-e),o=cc.p(-e,0);t.drawPoly([n,a,l,o],i,1,r)}}),cc._RFpop()},{}],DrawLayer:[function(t,e,n){"use strict";cc._RFpush(e,"cdbf2vnqQRJJonNlkGqATcJ","DrawLayer");var i=5,r=cc.color(255,255,255);cc.Class({"extends":cc.Component,properties:{cellManager:{visible:!1,"default":null}},initByNode:function(t){this.cellManager=t.cellManager},animateAttack:function(t,e){var n=this.cellManager.pointToPositionAR(t),a=this.cellManager.pointToPositionAR(e),l=new cc.DrawNode;l.drawSegment(n,a,i,r),this.node._sgNode.addChild(l),l.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){l.removeFromParent()})))},drawDiamond:function(t,e,n){var i=cc.p(t.x,t.y+e),r=cc.p(t.x,t.y-e),a=cc.p(t.x+e,t.y),l=cc.p(t.x-e,t.y);this.drawNode.drawPoly([i,r,a,l],cc.p(0,0,0,255),10,n)},onLoad:function(){}}),cc._RFpop()},{}],1:[function(t,e,n){(function(){function t(t){function e(e,n,i,r,a,l){for(;a>=0&&l>a;a+=t){var o=r?r[a]:a;i=n(i,e[o],o,e)}return i}return function(n,i,r,a){i=S(i,a,4);var l=!B(n)&&b.keys(n),o=(l||n).length,s=t>0?0:o-1;return arguments.length<3&&(r=n[l?l[s]:s],s+=t),e(n,i,r,l,s,o)}}function i(t){return function(e,n,i){n=M(n,i);for(var r=k(e),a=t>0?0:r-1;a>=0&&r>a;a+=t)if(n(e[a],a,e))return a;return-1}}function r(t,e,n){return function(i,r,a){var l=0,o=k(i);if("number"==typeof a)t>0?l=a>=0?a:Math.max(a+o,l):o=a>=0?Math.min(a+1,o):a+o+1;else if(n&&a&&o)return a=n(i,r),i[a]===r?a:-1;if(r!==r)return a=e(p.call(i,l,o),b.isNaN),a>=0?a+l:-1;for(a=t>0?l:o-1;a>=0&&o>a;a+=t)if(i[a]===r)return a;return-1}}function a(t,e){var n=A.length,i=t.constructor,r=b.isFunction(i)&&i.prototype||u,a="constructor";for(b.has(t,a)&&!b.contains(e,a)&&e.push(a);n--;)a=A[n],a in t&&t[a]!==r[a]&&!b.contains(e,a)&&e.push(a)}var l=this,o=l._,s=Array.prototype,u=Object.prototype,c=Function.prototype,h=s.push,p=s.slice,d=u.toString,f=u.hasOwnProperty,g=Array.isArray,v=Object.keys,y=c.bind,m=Object.create,C=function(){},b=function(t){return t instanceof b?t:this instanceof b?void(this._wrapped=t):new b(t)};"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=b),n._=b):l._=b,b.VERSION="1.8.3";var S=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,a){return t.call(e,n,i,r,a)}}return function(){return t.apply(e,arguments)}},M=function(t,e,n){return null==t?b.identity:b.isFunction(t)?S(t,e,n):b.isObject(t)?b.matcher(t):b.property(t)};b.iteratee=function(t,e){return M(t,e,1/0)};var U=function(t,e){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var r=1;i>r;r++)for(var a=arguments[r],l=t(a),o=l.length,s=0;o>s;s++){var u=l[s];e&&void 0!==n[u]||(n[u]=a[u])}return n}},x=function(t){if(!b.isObject(t))return{};if(m)return m(t);C.prototype=t;var e=new C;return C.prototype=null,e},I=function(t){return function(e){return null==e?void 0:e[t]}},T=Math.pow(2,53)-1,k=I("length"),B=function(t){var e=k(t);return"number"==typeof e&&e>=0&&T>=e};b.each=b.forEach=function(t,e,n){e=S(e,n);var i,r;if(B(t))for(i=0,r=t.length;r>i;i++)e(t[i],i,t);else{var a=b.keys(t);for(i=0,r=a.length;r>i;i++)e(t[a[i]],a[i],t)}return t},b.map=b.collect=function(t,e,n){e=M(e,n);for(var i=!B(t)&&b.keys(t),r=(i||t).length,a=Array(r),l=0;r>l;l++){var o=i?i[l]:l;a[l]=e(t[o],o,t)}return a},b.reduce=b.foldl=b.inject=t(1),b.reduceRight=b.foldr=t(-1),b.find=b.detect=function(t,e,n){var i;return i=B(t)?b.findIndex(t,e,n):b.findKey(t,e,n),void 0!==i&&-1!==i?t[i]:void 0},b.filter=b.select=function(t,e,n){var i=[];return e=M(e,n),b.each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i},b.reject=function(t,e,n){return b.filter(t,b.negate(M(e)),n)},b.every=b.all=function(t,e,n){e=M(e,n);for(var i=!B(t)&&b.keys(t),r=(i||t).length,a=0;r>a;a++){var l=i?i[a]:a;if(!e(t[l],l,t))return!1}return!0},b.some=b.any=function(t,e,n){e=M(e,n);for(var i=!B(t)&&b.keys(t),r=(i||t).length,a=0;r>a;a++){var l=i?i[a]:a;if(e(t[l],l,t))return!0}return!1},b.contains=b.includes=b.include=function(t,e,n,i){return B(t)||(t=b.values(t)),("number"!=typeof n||i)&&(n=0),b.indexOf(t,e,n)>=0},b.invoke=function(t,e){var n=p.call(arguments,2),i=b.isFunction(e);return b.map(t,function(t){var r=i?e:t[e];return null==r?r:r.apply(t,n)})},b.pluck=function(t,e){return b.map(t,b.property(e))},b.where=function(t,e){return b.filter(t,b.matcher(e))},b.findWhere=function(t,e){return b.find(t,b.matcher(e))},b.max=function(t,e,n){var i,r,a=-(1/0),l=-(1/0);if(null==e&&null!=t){t=B(t)?t:b.values(t);for(var o=0,s=t.length;s>o;o++)i=t[o],i>a&&(a=i)}else e=M(e,n),b.each(t,function(t,n,i){r=e(t,n,i),(r>l||r===-(1/0)&&a===-(1/0))&&(a=t,l=r)});return a},b.min=function(t,e,n){var i,r,a=1/0,l=1/0;if(null==e&&null!=t){t=B(t)?t:b.values(t);for(var o=0,s=t.length;s>o;o++)i=t[o],a>i&&(a=i)}else e=M(e,n),b.each(t,function(t,n,i){r=e(t,n,i),(l>r||r===1/0&&a===1/0)&&(a=t,l=r)});return a},b.shuffle=function(t){for(var e,n=B(t)?t:b.values(t),i=n.length,r=Array(i),a=0;i>a;a++)e=b.random(0,a),e!==a&&(r[a]=r[e]),r[e]=n[a];return r},b.sample=function(t,e,n){return null==e||n?(B(t)||(t=b.values(t)),t[b.random(t.length-1)]):b.shuffle(t).slice(0,Math.max(0,e))},b.sortBy=function(t,e,n){return e=M(e,n),b.pluck(b.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var N=function(t){return function(e,n,i){var r={};return n=M(n,i),b.each(e,function(i,a){var l=n(i,a,e);t(r,i,l)}),r}};b.groupBy=N(function(t,e,n){b.has(t,n)?t[n].push(e):t[n]=[e]}),b.indexBy=N(function(t,e,n){t[n]=e}),b.countBy=N(function(t,e,n){b.has(t,n)?t[n]++:t[n]=1}),b.toArray=function(t){return t?b.isArray(t)?p.call(t):B(t)?b.map(t,b.identity):b.values(t):[]},b.size=function(t){return null==t?0:B(t)?t.length:b.keys(t).length},b.partition=function(t,e,n){e=M(e,n);var i=[],r=[];return b.each(t,function(t,n,a){(e(t,n,a)?i:r).push(t)}),[i,r]},b.first=b.head=b.take=function(t,e,n){return null!=t?null==e||n?t[0]:b.initial(t,t.length-e):void 0},b.initial=function(t,e,n){return p.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},b.last=function(t,e,n){return null!=t?null==e||n?t[t.length-1]:b.rest(t,Math.max(0,t.length-e)):void 0},b.rest=b.tail=b.drop=function(t,e,n){return p.call(t,null==e||n?1:e)},b.compact=function(t){return b.filter(t,b.identity)};var F=function(t,e,n,i){for(var r=[],a=0,l=i||0,o=k(t);o>l;l++){var s=t[l];if(B(s)&&(b.isArray(s)||b.isArguments(s))){e||(s=F(s,e,n));var u=0,c=s.length;for(r.length+=c;c>u;)r[a++]=s[u++]}else n||(r[a++]=s)}return r};b.flatten=function(t,e){return F(t,e,!1)},b.without=function(t){return b.difference(t,p.call(arguments,1))},b.uniq=b.unique=function(t,e,n,i){b.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=M(n,i));for(var r=[],a=[],l=0,o=k(t);o>l;l++){var s=t[l],u=n?n(s,l,t):s;e?(l&&a===u||r.push(s),a=u):n?b.contains(a,u)||(a.push(u),r.push(s)):b.contains(r,s)||r.push(s)}return r},b.union=function(){return b.uniq(F(arguments,!0,!0))},b.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=k(t);r>i;i++){var a=t[i];if(!b.contains(e,a)){for(var l=1;n>l&&b.contains(arguments[l],a);l++);l===n&&e.push(a)}}return e},b.difference=function(t){var e=F(arguments,!0,!0,1);return b.filter(t,function(t){return!b.contains(e,t)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(t){for(var e=t&&b.max(t,k).length||0,n=Array(e),i=0;e>i;i++)n[i]=b.pluck(t,i);return n},b.object=function(t,e){for(var n={},i=0,r=k(t);r>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},b.findIndex=i(1),b.findLastIndex=i(-1),b.sortedIndex=function(t,e,n,i){n=M(n,i,1);for(var r=n(e),a=0,l=k(t);l>a;){var o=Math.floor((a+l)/2);n(t[o])<r?a=o+1:l=o}return a},b.indexOf=r(1,b.findIndex,b.sortedIndex),b.lastIndexOf=r(-1,b.findLastIndex),b.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),a=0;i>a;a++,t+=n)r[a]=t;return r};var L=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var a=x(t.prototype),l=t.apply(a,r);return b.isObject(l)?l:a};b.bind=function(t,e){if(y&&t.bind===y)return y.apply(t,p.call(arguments,1));if(!b.isFunction(t))throw new TypeError("Bind must be called on a function");var n=p.call(arguments,2),i=function(){return L(t,i,e,this,n.concat(p.call(arguments)))};return i},b.partial=function(t){var e=p.call(arguments,1),n=function(){for(var i=0,r=e.length,a=Array(r),l=0;r>l;l++)a[l]=e[l]===b?arguments[i++]:e[l];for(;i<arguments.length;)a.push(arguments[i++]);return L(t,n,this,this,a)};return n},b.bindAll=function(t){var e,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(e=1;i>e;e++)n=arguments[e],t[n]=b.bind(t[n],t);return t},b.memoize=function(t,e){var n=function(i){var r=n.cache,a=""+(e?e.apply(this,arguments):i);return b.has(r,a)||(r[a]=t.apply(this,arguments)),r[a]};return n.cache={},n},b.delay=function(t,e){var n=p.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},b.defer=b.partial(b.delay,b,1),b.throttle=function(t,e,n){var i,r,a,l=null,o=0;n||(n={});var s=function(){o=n.leading===!1?0:b.now(),l=null,a=t.apply(i,r),l||(i=r=null)};return function(){var u=b.now();o||n.leading!==!1||(o=u);var c=e-(u-o);return i=this,r=arguments,0>=c||c>e?(l&&(clearTimeout(l),l=null),o=u,a=t.apply(i,r),l||(i=r=null)):l||n.trailing===!1||(l=setTimeout(s,c)),a}},b.debounce=function(t,e,n){var i,r,a,l,o,s=function(){var u=b.now()-l;e>u&&u>=0?i=setTimeout(s,e-u):(i=null,n||(o=t.apply(a,r),i||(a=r=null)))};return function(){a=this,r=arguments,l=b.now();var u=n&&!i;return i||(i=setTimeout(s,e)),u&&(o=t.apply(a,r),a=r=null),o}},b.wrap=function(t,e){return b.partial(e,t)},b.negate=function(t){return function(){return!t.apply(this,arguments)}},b.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},b.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},b.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=null),n}},b.once=b.partial(b.before,2);var _=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(t){if(!b.isObject(t))return[];if(v)return v(t);var e=[];for(var n in t)b.has(t,n)&&e.push(n);return _&&a(t,e),e},b.allKeys=function(t){if(!b.isObject(t))return[];var e=[];for(var n in t)e.push(n);return _&&a(t,e),e},b.values=function(t){for(var e=b.keys(t),n=e.length,i=Array(n),r=0;n>r;r++)i[r]=t[e[r]];return i},b.mapObject=function(t,e,n){e=M(e,n);for(var i,r=b.keys(t),a=r.length,l={},o=0;a>o;o++)i=r[o],l[i]=e(t[i],i,t);return l},b.pairs=function(t){for(var e=b.keys(t),n=e.length,i=Array(n),r=0;n>r;r++)i[r]=[e[r],t[e[r]]];return i},b.invert=function(t){for(var e={},n=b.keys(t),i=0,r=n.length;r>i;i++)e[t[n[i]]]=n[i];return e},b.functions=b.methods=function(t){var e=[];for(var n in t)b.isFunction(t[n])&&e.push(n);return e.sort()},b.extend=U(b.allKeys),b.extendOwn=b.assign=U(b.keys),b.findKey=function(t,e,n){e=M(e,n);for(var i,r=b.keys(t),a=0,l=r.length;l>a;a++)if(i=r[a],e(t[i],i,t))return i},b.pick=function(t,e,n){var i,r,a={},l=t;if(null==l)return a;b.isFunction(e)?(r=b.allKeys(l),i=S(e,n)):(r=F(arguments,!1,!1,1),i=function(t,e,n){return e in n},l=Object(l));for(var o=0,s=r.length;s>o;o++){var u=r[o],c=l[u];i(c,u,l)&&(a[u]=c)}return a},b.omit=function(t,e,n){if(b.isFunction(e))e=b.negate(e);else{var i=b.map(F(arguments,!1,!1,1),String);e=function(t,e){return!b.contains(i,e)}}return b.pick(t,e,n)},b.defaults=U(b.allKeys,!0),b.create=function(t,e){var n=x(t);return e&&b.extendOwn(n,e),n},b.clone=function(t){return b.isObject(t)?b.isArray(t)?t.slice():b.extend({},t):t},b.tap=function(t,e){return e(t),t},b.isMatch=function(t,e){var n=b.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),a=0;i>a;a++){var l=n[a];if(e[l]!==r[l]||!(l in r))return!1}return!0};var R=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof b&&(t=t._wrapped),e instanceof b&&(e=e._wrapped);var r=d.call(t);if(r!==d.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var a="[object Array]"===r;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var l=t.constructor,o=e.constructor;if(l!==o&&!(b.isFunction(l)&&l instanceof l&&b.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var s=n.length;s--;)if(n[s]===t)return i[s]===e;if(n.push(t),i.push(e),a){if(s=t.length,s!==e.length)return!1;for(;s--;)if(!R(t[s],e[s],n,i))return!1}else{var u,c=b.keys(t);if(s=c.length,b.keys(e).length!==s)return!1;for(;s--;)if(u=c[s],!b.has(e,u)||!R(t[u],e[u],n,i))return!1}return n.pop(),i.pop(),!0};b.isEqual=function(t,e){return R(t,e)},b.isEmpty=function(t){return null==t?!0:B(t)&&(b.isArray(t)||b.isString(t)||b.isArguments(t))?0===t.length:0===b.keys(t).length},b.isElement=function(t){return!(!t||1!==t.nodeType)},b.isArray=g||function(t){return"[object Array]"===d.call(t)},b.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){b["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),b.isArguments(arguments)||(b.isArguments=function(t){return b.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(t){return"function"==typeof t||!1}),b.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},b.isNaN=function(t){return b.isNumber(t)&&t!==+t},b.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===d.call(t)},b.isNull=function(t){return null===t},b.isUndefined=function(t){return void 0===t},b.has=function(t,e){return null!=t&&f.call(t,e)},b.noConflict=function(){return l._=o,this},b.identity=function(t){return t},b.constant=function(t){return function(){return t}},b.noop=function(){},b.property=I,b.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},b.matcher=b.matches=function(t){return t=b.extendOwn({},t),function(e){return b.isMatch(e,t)}},b.times=function(t,e,n){var i=Array(Math.max(0,t));e=S(e,n,1);for(var r=0;t>r;r++)i[r]=e(r);return i},b.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},b.now=Date.now||function(){return(new Date).getTime()};var O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=b.invert(O),w=function(t){var e=function(e){return t[e]},n="(?:"+b.keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};b.escape=w(O),b.unescape=w(P),b.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),b.isFunction(i)?i.call(t):i};var E=0;b.uniqueId=function(t){var e=++E+"";return t?t+e:e},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+j[t]};b.template=function(t,e,n){!e&&n&&(e=n),e=b.defaults({},e,b.templateSettings);var i=RegExp([(e.escape||D).source,(e.interpolate||D).source,(e.evaluate||D).source].join("|")+"|$","g"),r=0,a="__p+='";t.replace(i,function(e,n,i,l,o){return a+=t.slice(r,o).replace(H,W),r=o+e.length,n?a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":l&&(a+="';\n"+l+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var l=new Function(e.variable||"obj","_",a)}catch(o){throw o.source=a,o}var s=function(t){return l.call(this,t,b)},u=e.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s},b.chain=function(t){var e=b(t);return e._chain=!0,e};var z=function(t,e){return t._chain?b(e).chain():e};b.mixin=function(t){b.each(b.functions(t),function(e){var n=b[e]=t[e];b.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),z(this,n.apply(b,t))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];b.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],z(this,n)}}),b.each(["concat","join","slice"],function(t){var e=s[t];b.prototype[t]=function(){return z(this,e.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}).call(this)},{}],FlyPoint:[function(t,e,n){"use strict";cc._RFpush(e,"0a429ad3n9IyYzzLWmejwS7","FlyPoint");var i=t("BasePoint");cc.Class({"extends":i,properties:{nodeBase:{visible:!1,"default":null}},initByNode:function(t,e){var n=t.cellManager;this.cellManager=n,this.nodeBase=t,this.point.x=e.x,this.point.y=e.y;var i=n.pointToCell(e);this.cell.x=i.x,this.cell.y=i.y,this.updatePosition()},changeCell:function(t,e){},moveDirect:function(t,e){var n=Math.abs(t.x)+Math.abs(t.y),i=1*e*t.x/n,r=1*e*t.y/n;this.point.x+=i,this.point.y+=r,this.updateCell()},moveDstPoint:function(t,e){var n=t.x-this.point.x,i=t.y-this.point.y;Math.abs(n)+Math.abs(i)>e?this.moveDirect({x:n,y:i},e):(this.point.x=t.x,this.point.y=t.y,this.updateCell())}}),cc._RFpop()},{BasePoint:"BasePoint"}],GameControl:[function(t,e,n){"use strict";cc._RFpush(e,"176f9JaxudNEqq31wzCQlaY","GameControl");var i=t("riddleUtil"),r=["map/first","map/hatred","map/speed","map/battle1","map/battle2"],a=r.length,l=null,o=null;cc.Class({"extends":cc.Component,properties:{restartNode:cc.Node,preNode:cc.Node,nextNode:cc.Node,battleNode:cc.Node,battlePrefab:cc.Prefab,mapIndex:0,infoLabel:cc.Label,winLabel:cc.Label,cnText:{visible:!1,get:function(){return this.getComponent("CnText")}}},onLoad:function(){l=this.winLabel.string,this.winLabel.string="";var t=this;t.battleNode.getComponent("BattleFieldComponent").loadMap(),t.battleNode.zIndex=-1,o=t.battleNode.position,this.restartNode.on(cc.Node.EventType.TOUCH_START,function(e){t.battleNode.getComponent("BattleFieldComponent");t.loadMapByIndex(t.mapIndex)}),this.preNode.on(cc.Node.EventType.TOUCH_START,function(e){t.preMap()}),this.nextNode.on(cc.Node.EventType.TOUCH_START,function(e){t.nextMap()}),t.preNode.active=!1,this.bindTest(),this.loadMapByIndex(0)},loadMapByIndex:function(t){this.winLabel.string="",this.infoLabel.string=this.cnText.missionInfo[t];var e=r[t];this.battleNode.removeFromParent();var n=cc.instantiate(this.battlePrefab);this.battleNode=n,n.getComponent("BattleFieldComponent").loadMapByUrl(e),n.getComponent("BattleFieldComponent").gameCtrl=this,this.node.addChild(n,-1,t),n.position=o},bindTest:function(){i.test.gameNode=this,i.test.nextNode=this.nextNode},preMap:function(){var t=this;t.mapIndex>0?(t.mapIndex-=1,t.loadMapByIndex(t.mapIndex)):console.log("no pre map"),0==t.mapIndex&&(t.preNode.active=!1),t.nextNode.active=!0,t.nextNode.getComponent("cc.Button").interactable=!0},nextMap:function(){var t=this;t.mapIndex<a-1?(t.mapIndex+=1,t.loadMapByIndex(t.mapIndex)):console.log("no next map"),t.mapIndex==a-1&&(t.nextNode.active=!1),t.preNode.active=!0,t.preNode.getComponent("cc.Button").interactable=!0},win:function(){var t=this;t.mapIndex>=a-1?this.winLabel.string=this.cnText.missionComplete+"\n"+this.cnText.noNextMap:(this.winLabel.string=this.cnText.missionComplete+"\n"+this.cnText.nextMap,this.winLabel.node.once(cc.Node.EventType.TOUCH_START,function(e){t.nextMap()}))}}),cc._RFpop()},{riddleUtil:"riddleUtil"}],InputController:[function(t,e,n){"use strict";cc._RFpush(e,"bcfe0NOU59IiafpxJBJOCxV","InputController");var i=t("CellManager"),r=t("UnitManager"),a=(t("UserInputList"),t("UserInput").InputObject),l=t("UserInput").InputType,o=t("underscore"),s=cc.color(111,111,0),u=cc.color(255,255,255),c=cc.Class({name:"OperContext",properties:{startFlag:!1,ctrl:null,unit:null,unitInter:null},ctor:function(){this.ctrl=arguments[0],this.startFlag=!1,this.unit=null},start:function(t){this.startFlag=!0,this.unit=t,this.unitInter=t.getComponent("UnitInter"),this.unit.getComponent("UnitMove").onStartOper(this)},oper:function(t){this.unit.getComponent("UserInputList").add(t)},onCtrlCancel:function(){o.isObject(this.unit)&&this.unit.getComponent("UnitMove").cancelOper(),this.startFlag=!1,this.unit=null},onUnitCancel:function(){this.ctrl.cancelOper(),this.startFlag=!1,this.unit=null},teamSame:function(t){return this.unit.getComponent("UnitInter").team==t},idSame:function(t){return this.unit.getComponent("UnitBase").unitId==t}});cc.Class({"extends":cc.Component,properties:{cellManager:{type:i,"default":null},unitManager:{type:r,"default":null},focusItem:{type:cc.Node,"default":null},preCell:{"default":new cc.Vec2(-1,-1)},oper:{type:c,"default":null},stayTime:0,staySlice:.7,stayFlag:!1,overItemCounter:0},onLoad:function(){this.bindMouseListener(),this.oper=new c(this)},isStart:function(){return this.oper.startFlag},startCell:function(t){this.stayTime=0,this.stayFlag=!1;var e=this.unitManager.unit$(t);o.isObject(e)&&e.getComponent("UnitInter").canOper()&&(this.oper.start(e),this.preCell=t,this.focusItem.color=s)},overCell:function(t){if(this.isStart()&&(t.x!=this.preCell.x||t.y!=this.preCell.y)){this.stayFlag=!1,this.stayTime=0,console.log("over cell : ",t.x,t.y);this.preCell;this.preCell=t;var e=this.unitManager.unit$(t);if(o.isObject(e)){this.overItemCounter=0;var n=e.getComponent("UnitInter");if(this.oper.idSame(n.getUnitId())){var i=new a(l.MOVE,t);this.oper.oper(i)}else{var i=new a(l.OPER,t,n);this.oper.oper(i)}}else if(this.cellManager.canMove(t)){this.overItemCounter=0;var i=new a(l.MOVE,t);this.oper.oper(i)}else this.cellManager.isItem(t)?this.overItemCounter<=1?this.overItemCounter+=1:this.overItemCounter>=2&&this.cancel():this.cancel()}},stayCell:function(){if(this.isStart()){var t=this.unitManager.unit$(this.preCell);if(!o.isObject(t)){if(this.oper.unitInter.isMoving())return;var e=new a(l.MOVE,this.preCell);return void this.oper.oper(e)}var n=t.getComponent("UnitInter");if(!this.oper.idSame(n.getUnitId())&&!this.oper.unitInter.isMoving()){var e=new a(l.OPER,this.preCell,n);this.oper.oper(e)}}},cancel:function(){this.oper.onCtrlCancel(),this.cancelOper()},cancelOper:function(){this.stayTime=0,this.stayFlag=!1,this.preCell=cc.p(-1,-1),this.focusItem.color=u,this.overItemCounter=0},bindTouchListener:function(){},bindMouseListener:function(){var t=this,e=this.node;e.on(cc.Node.EventType.MOUSE_DOWN,function(e){if(e.getButton()==cc.Event.EventMouse.BUTTON_LEFT){var n=t.locationToCell(e.getLocation());t.isStart()?t.cancel():t.startCell(n)}});var n=this.focusItem;e.on(cc.Node.EventType.MOUSE_MOVE,function(e){var i=t.locationToCell(e.getLocation()),r=t.cellManager.cellToPositionAR(i);n.attr({x:r.x,y:r.y,active:!0}),t.overCell(i)}),e.on(cc.Node.EventType.MOUSE_LEAVE,function(e){t.cancel(),n.active=!1})},bindTouchListener:function(){var t=this,e=this.node;e.on(cc.Node.EventType.TOUCH_START,function(e){var n=t.locationToCell(e.getLocation());t.isStart()?t.cancel():t.startCell(n)});var n=this.focusItem;e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var i=t.locationToCell(e.getLocation()),r=t.cellManager.cellToPositionAR(i);n.attr({x:r.x,y:r.y,active:!0}),t.overCell(i)}),e.on(cc.Node.EventType.TOUCH_END,function(e){t.cancel(),n.active=!1})},locationToCell:function(t){var e=this.node.convertToNodeSpace(t);return this.cellManager.positionToCell(e);
},update:function(t){this.stayFlag&&(this.stayTime+=t,this.stayTime>=this.staySlice&&(this.stayCell(),this.stayTime=0)),this.isStart()&&(this.stayFlag=!0)}}),cc._RFpop()},{CellManager:"CellManager",UnitManager:"UnitManager",UserInput:"UserInput",UserInputList:"UserInputList",underscore:1}],PanelButton:[function(t,e,n){"use strict";cc._RFpush(e,"1d520uemoVMmpD+4ieIwOHw","PanelButton"),cc.Class({"extends":cc.Component,properties:{panelNode:{visible:!1,get:function(){return this.node.getChildByName("Panel")}}},onLoad:function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.panelNode.active=!t.panelNode.active}),this.panelNode.active=!1}}),cc._RFpop()},{}],Skill:[function(t,e,n){"use strict";cc._RFpush(e,"57edbGeC8ZLC7elk2CRnLxo","Skill");var i=cc.Class({name:"SkillBase",properties:{unit:null,unitBase:null,unitSkill:null},ctor:function(){},bind:function(t){this.unit=t,this.unitSkill=this.unit.getComponent("UnitSkill"),this.unitBase=this.unit.getComponent("UnitBase"),this.unitInter=this.unit.getComponent("UnitInter")},cast:function(){console.log("cast skill")},update:function(t){}});e.exports={SkillBase:i},cc._RFpop()},{}],SlidePoint:[function(t,e,n){"use strict";cc._RFpush(e,"d6bc00SMM9Hw66GtOmvoge+","SlidePoint");var i=t("BasePoint"),r=(t("riddleUtil"),0),a=1,l=2;cc.Class({"extends":i,properties:{slideState:{visible:!1,"default":0},nodeBase:{visible:!1,"default":null}},changeCell:function(t,e){this.nodeBase.cellChangeHandler(t,e)},initByNode:function(t,e){var n=t.cellManager;this.cellManager=n,this.nodeBase=t,this.cell.x=e.x,this.cell.y=e.y;var i=n.cellToPoint(e);this.point.x=i.x,this.point.y=i.y,this.updatePosition()},pointSlide:function(t,e){var n=t.x-this.point.x,i=t.y-this.point.y,o=Math.abs(n),s=Math.abs(i);if(e>=o+s)this.point.x=t.x,this.point.y=t.y,this.slideState=r;else{var u=n>0?1:-1,c=i>0?1:-1,h=this.slideState;switch(h==r&&(h=s>o?a:l),h){case a:e>o?(this.point.x=t.x,this.point.y+=c*(e-o),this.slideState=l):o==e?(this.point.y=t.y,this.slideState=r):this.point.x+=u*e;break;case l:e>s?(this.point.y=t.y,this.point.x+=u*(e-s),this.slideState=a):s==e?(this.point.y=t.y,this.slideState=r):this.point.y+=c*e}}},moveSelfCell:function(t,e){var n=this.cellManager.cellToPoint(t);this.pointSlide(n,e)},moveNearCell:function(t,e){var n=this.cellManager.cellToPoint(t);this.pointSlide(n,e),this.updateCell()},canStand:function(){return this.slideState==r}}),cc._RFpop()},{BasePoint:"BasePoint",riddleUtil:"riddleUtil"}],StraightBullet:[function(t,e,n){"use strict";cc._RFpush(e,"16aedm7eAxIDYX2LDq3DpNM","StraightBullet");var i=t("BulletBase"),r=(t("underscore"),t("riddleUtil"));cc.Class({"extends":i,properties:{colideDelta:5,direct:cc.p(0,0),speed:{get:function(){return 60}}},initByBulletManager:function(t,e,n){this._super.apply(this,arguments);var i=this.flyPoint.point,r=this.targetInter.getPoint();this.direct=cc.p(r.x-i.x,r.y-i.y)},colide:function(){for(var t=this.flyPoint.cell,e=r.radioRange(t,1),n=[],i=0,a=e.length;a>i;i++){var l=e[i],o=this.unitManager.unitInter$(l);if(o){if(o.unitId==this.sourceInter.unitId)continue;if(o.team==this.sourceInter.team)continue;var s=r.euDistance(o.getPoint(),this.flyPoint.point);s<=this.colideDelta&&n.push(o)}}var u=this;n.length>0&&(this.died=!0,this.actionExplode(function(){u.targetInter.onHurtByBullet(u.sourceInter,u.harm),u.bulletManager.removeBullet(u.bulletId)}))},update:function(t){if(!this.died&&(this.flyPoint.moveDirect(this.direct,this.speed*t),this.flyPoint.updatePosition(),this.died||this.colide(),!this.died)){var e=r.maDistance(this.startPoint,this.flyPoint.point);e>this.distance&&(this.died=!0,this.bulletManager.removeBullet(this.bulletId))}}}),cc._RFpop()},{BulletBase:"BulletBase",riddleUtil:"riddleUtil",underscore:1}],TiledMapAdapter:[function(t,e,n){"use strict";cc._RFpush(e,"5fa6eK3QWpCbpPyb2TMg3fo","TiledMapAdapter"),cc.Class({"extends":cc.Component,properties:{tiledMap:{visible:!1,get:function(){return this.getComponent("cc.TiledMap")}},tileRange:{visible:!1,get:function(){var t=this.tiledMap.getMapSize();return cc.p(t.width,t.height)}},tileSize:{visible:!1,get:function(){var t=this.tiledMap.getTileSize();return cc.p(t.width,t.height)}}},getLayerPropertiesAt:function(t,e){var n=e.x,i=this.tileRange.y-1-e.y,r=this.node.getChildByName(t).getComponent("cc.TiledLayer"),a=r.getTileGIDAt(n,i),l=this.tiledMap.getPropertiesForGID(a);return l},getLayerNode:function(t){return this.node.getChildByName(t)}}),cc._RFpop()},{}],TrackBullet:[function(t,e,n){"use strict";cc._RFpush(e,"c0c38+3HCBNtqC9a3tsaBHO","TrackBullet");var i=t("BulletBase"),r=(t("FlyPoint"),t("UnitManager"),t("CellManager"),t("underscore"),t("riddleUtil"));cc.Class({"extends":i,properties:{colideDelta:1,speed:{get:function(){return 120}}},initByBulletManager:function(t,e,n){this._super.apply(this,arguments)},update:function(t){if(!this.died){var e=this.targetInter.getPoint(),n=this.flyPoint.point,i=r.euDistance(n,e);if(i<this.colideDelta){this.died=!0;var a=this;this.actionExplode(function(){a.targetInter.onHurtByBullet(a.sourceInter,a.harm),a.bulletManager.removeBullet(a.bulletId)})}else this.flyPoint.moveDstPoint(e,this.speed*t),this.flyPoint.updatePosition()}}}),cc._RFpop()},{BulletBase:"BulletBase",CellManager:"CellManager",FlyPoint:"FlyPoint",UnitManager:"UnitManager",riddleUtil:"riddleUtil",underscore:1}],TranController:[function(t,e,n){"use strict";cc._RFpush(e,"04f80p9VMVEPqyJa5LR7jnd","TranController");var i=t("BattleFieldComponent"),r=t("riddleUtil"),a=t("underscore");cc.Class({"extends":cc.Component,properties:{battleField:{type:i,visible:!1,"default":null},innerNode:{type:cc.Node,"default":null},lastLoction1:{visible:!1,"default":cc.p(0,0)},lastLocation2:{visible:!1,"default":cc.p(0,0)},rightDown:{visible:!1,"default":!1},doTran:{visible:!1,"default":!1}},onLoad:function(){this.battleField=this.getComponent("BattleFieldComponent")},beginTran:function(t,e){this.lastLocation1=t,this.lastLocation2=e},tran:function(t,e){if(a.isObject(e)){var n=r.euDistance(t,this.lastLocation1),i=r.euDistance(e,this.lastLocation2);if(n>i){var l=t;t=e,e=l}}if(this.moveTran(t.x-this.lastLocation1.x,t.y-this.lastLocation1.y),a.isObject(e)&&a.isObject(this.lastLocation2)){var o=r.euDistance(this.lastLocation1,this.lastLocation2),s=r.euDistance(t,e);this.scaleTran(s/o,t)}this.lastLocation1=t,this.lastLoctaion2=e},endTran:function(t,e){var n=t.x-this.lastLocation1.x,i=t.y-this.lastLocation1.y},moveTran:function(t,e){var n=this.node,i=n.x+t,r=n.y+e;n.attr({x:i,y:r})},scaleTran:function(t,e){var n=this.node,i=n.x+n.getScaleX()*e.x*(1-t),r=n.y+n.getScaleY()*e.y*(1-t);n.attr({scaleX:t*n.getScaleX(),scaleY:t*n.getScaleY(),x:i,y:r})},bindMouseListener:function(){var t=this;this.innerNode.on(cc.Node.EventType.MOUSE_DOWN,function(e){e.getButton()==cc.Event.EventMouse.BUTTON_RIGHT&&(t.rightDown=!0,t.beginTran({x:e.getLocationX(),y:e.getLocationY()}))}),this.innerNode.on(cc.Node.EventType.MOUSE_MOVE,function(e){return t.rightDown?(t.tran({x:e.getLocationX(),y:e.getLocationY()}),!0):!1}),this.innerNode.on(cc.Node.EventType.MOUSE_UP,function(e){return e.getButton()==cc.Event.EventMouse.BUTTON_RIGHT?(t.rightDown=!1,t.tran({x:e.getLocationX(),y:e.getLocationY()}),!0):!1}),this.innerNode.on(cc.Node.EventType.MOUSE_WHEEL,function(e){var n=e.getScrollY(),i=e.getLocation(),i=t.node.convertToNodeSpaceAR(i);n>=0?t.scaleTran(1.25,i):t.scaleTran(.8,i)})}}),cc._RFpop()},{BattleFieldComponent:"BattleFieldComponent",riddleUtil:"riddleUtil",underscore:1}],UnitAttributes:[function(t,e,n){"use strict";cc._RFpush(e,"d153aW1MG5Dhb3HQzIZ1cgw","UnitAttributes"),cc.Class({"extends":cc.Component,properties:{observeRange:1,speed:25,_maxHp:{visible:!1,"default":2},maxHp:{set:function(t){this._maxHp=t,this.hp>t&&(this.hp=t)},get:function(){return this._maxHp}},_hp:{visible:!1,"default":2},hp:{set:function(t){this.hpLabel.string=String(t),this._hp=t,this._hp<=0&&this.getComponent("UnitBase").unitDeadHandler()},get:function(){return this._hp}},_ap:{visible:!1,"default":1},ap:{set:function(t){this.apLabel.string=String(t),this._ap=t},get:function(){return this._ap}},apNodeName:"ap",hpNodeName:"hp",hpLabel:{visible:!1,get:function(){return this.node.getChildByName(this.hpNodeName).getComponent("cc.Label")}},apLabel:{visible:!1,get:function(){return this.node.getChildByName(this.apNodeName).getComponent("cc.Label")}}},getSpeed:function(){return this.speed}}),cc._RFpop()},{}],UnitBase:[function(t,e,n){"use strict";cc._RFpush(e,"8871bnAwDZFIombdU+mUMqV","UnitBase");var i=(t("SlidePoint"),t("CellManager")),r=t("UnitManager");cc.Class({"extends":cc.Component,properties:{unitId:{type:cc.Integer,visible:!1,"default":0},cellManager:{type:i,visible:!1,"default":null},unitManager:{type:r,visible:!1,"default":null},initFinished:{visible:!1,"default":!1}},initByUnitManager:function(t,e){var n=e.cell,i=e.unitId,r=(e.category,t.cellManager);this.cellManager=r,this.unitManager=t,this.battleField=t.battleField,this.bulletManager=this.battleField.bulletManager,this.unitId=i,this.getComponent("SlidePoint").initByNode(this,n);var a=r.cellToPositionAR(n);this.node.attr({x:a.x,y:a.y}),this.getComponent("UnitCategory").initWithConfig(e),this.getComponent("UnitInter").initWithConfig(e),this.initFinished=!0,this.getComponent("UnitSkill").unitInit()},cellChangeHandler:function(t,e){this.unitManager.unitChangeCell(this.node,t,e)},unitDeadHandler:function(){this.getComponent("UnitInter").died=!0,this.getComponent("UnitMove").deadCancel(),this.unitManager.unitDead(this.node)}}),cc._RFpop()},{CellManager:"CellManager",SlidePoint:"SlidePoint",UnitManager:"UnitManager"}],UnitCategory:[function(t,e,n){"use strict";cc._RFpush(e,"d1fdeZjyrlCspp8o9SVixeb","UnitCategory");var i=t("underscore"),r=t("skillCategory"),a=(cc.Enum({SOLDIER:1,TOWER:2,ARROW:3,SWORD:4,HORSE:5,KNIFE:6,STICK:7,BOW:8,AXE:9,WING:10}),{SOLDIER:{hp:8,ap:1,speed:25,bulletSpeed:10,observeRange:1,skills:["HIT"]},TOWER:{hp:3,ap:2,speed:25,bulletSpeed:10,observeRange:2,skills:["STAND"]},ARROW:{hp:3,ap:1,speed:25,bulletSpeed:10,skills:[]},SWORD:{hp:2,ap:3,speed:25,bulletSpeed:10,skills:[]},HORSE:{hp:2,ap:1,speed:25,bulletSpeed:10,skills:[]},BOW:{hp:2,ap:3,speed:25,bulletSpeed:10,observeRange:2,skills:["TRACK_STAND"]},KNIFE:{hp:1,ap:4,speed:25,bulletSpeed:10,skills:["HIT","STEALTH"]},STICK:{hp:3,ap:2,speed:25,bulletSpeed:10,skills:["HIT"]},AXE:{hp:2,ap:2,speed:25,bulletSpeed:10,skills:["HURT"]},WING:{hp:1,ap:4,speed:50,bulletSpeed:10,skills:["HIT"]}}),l={SOLDIER:"unit/soldier",TOWER:"unit/tower",ARROW:"unit/arrow",SWORD:"unit/sword",HORSE:"unit/horse",KNIFE:"unit/knife",STICK:"unit/stick",BOW:"unit/bow",AXE:"unit/axe",WING:"unit/wing",NULL:"unit/desktop"};cc.Class({"extends":cc.Component,properties:{category:null},initWithConfig:function(t){var e=t.category;this.category=e;var n=this.getComponent("cc.Sprite");if(t.spriteFrame)n.spriteFrame=t.spriteFrame;else{var i=l[e];i||(i=l.NULL),cc.loader.loadRes(i,cc.SpriteFrame,function(t,e){t&&console.log(t),n.spriteFrame=e})}var r=a[e];r&&(this.skillInit(r.skills),this.attributeInit(r)),1!=this.team&&("TOWER"!=this.category&&"BOW"!=this.category||this.getComponent("DrawItem").showObserve())},attributeInit:function(t){var e=this.getComponent("UnitAttributes");i.each(t,function(t,n){"hp"==n?(e.hp=t,e.maxHp=t):"skill"!=n&&(e[n]=t)})},skillInit:function(t){for(var e=this.getComponent("UnitSkill"),n=0,i=t.length;i>n;n++){var a=t[n],l=r.CategoryToClass[a];e.addSkill(new l)}},update:function(t){}}),cc._RFpop()},{skillCategory:"skillCategory",underscore:1}],UnitConfigManager:[function(t,e,n){"use strict";cc._RFpush(e,"7605f3o9I1FdLcaQ6nxdQUm","UnitConfigManager");var i=t("underscore");cc.Class({"extends":cc.Component,properties:{tiledLayerName:"unitConfig",teamTiledLayerName:"teamConfig",keyTiledLayerName:"keyUnit",tiledMapAdapter:{visible:!1,get:function(){return this.getComponent("TiledMapAdapter")}}},initByNode:function(t){},getUnitConfigAt:function(t){var e=this.getCategoryAt(t),n=this.getTeamAt(t),i=this.getKeyAt(t);return e?{category:e,spriteFrame:null,team:n,key:i}:null},getCategoryAt:function(t){var e=this.tiledMapAdapter.getLayerPropertiesAt(this.tiledLayerName,t);return i.isObject(e)&&i.has(e,"category")?e.category:null},getTeamAt:function(t){var e=this.tiledMapAdapter.getLayerPropertiesAt(this.teamTiledLayerName,t);return i.isObject(e)&&i.has(e,"team")?e.team:null},getKeyAt:function(t){var e=this.tiledMapAdapter.getLayerPropertiesAt(this.keyTiledLayerName,t);return i.isObject(e)&&i.has(e,"key")?e.key:null},hideConfigLayer:function(){var t=this.tiledMapAdapter.getLayerNode(this.teamTiledLayerName);t.active=!1;var e=this.tiledMapAdapter.getLayerNode(this.tiledLayerName);e.active=!1;var n=this.tiledMapAdapter.getLayerNode(this.keyTiledLayerName);n.active=!1}}),cc._RFpop()},{underscore:1}],UnitInter:[function(t,e,n){"use strict";cc._RFpush(e,"4e612sfo/1OEr6QZF1vpWZZ","UnitInter");var i={0:cc.color(255,255,255),1:cc.color(0,0,255),2:cc.color(255,0,0),3:cc.color(0,0,0)};cc.Class({"extends":cc.Component,properties:{died:!1,_stealth:!1,stealth:{get:function(){return this._stealth},set:function(t){this._stealth!=t&&(t?this.node.opacity=70:this.node.opacity=255,this._stealth=t)}},stealthNodeName:"stealth",stealthNode:{get:function(){return this.node.getChildByName(this.stealthNodeName)}},operFlag:!1,unitId:{visible:!1,get:function(){return this.getComponent("UnitBase").unitId}},teamNodeName:"team",teamNode:{visible:!1,get:function(){return this.node.getChildByName(this.teamNodeName)}},_team:{visible:!1,"default":0},team:{get:function(){return this._team},set:function(t){this.teamNode.color=i[t],this._team=t}},hurtNodeName:"hurt",hurtNode:{visible:!1,get:function(){return this.node.getChildByName(this.hurtNodeName)}},keyNodeName:"key",keyNode:{visible:!1,get:function(){return this.node.getChildByName(this.keyNodeName)}},key:!1},initWithConfig:function(t){this.team=t.team,this.key=t.key,1==t.team?(this.operFlag=!0,this.keyNode.active=!1):this.operFlag=!1,t.key?this.keyNode.active=!0:this.keyNode.active=!1},canOper:function(){return this.operFlag},canBeObserved:function(){return!this.stealth},onHurtByBack:function(t,e){var n=this;this.hurtNode.attr({scaleX:0,scaleY:0,visible:!0,opacity:255}),this.hurtNode.runAction(cc.sequence(cc.scaleTo(.1,1,1),cc.fadeOut(.1),cc.callFunc(function(){n.getComponent("UnitAttributes").hp-=e})))},onHurtByHit:function(t,e){this.getComponent("UnitAttributes").hp-=e,this.getComponent("UnitSkill").unitHurt(t)},onHurtByBullet:function(t,e){this.getComponent("UnitAttributes").hp-=e,this.getComponent("UnitSkill").unitHurt(t)},getAttackVisible:function(){return!this.stealth},getAttackPriority:function(){return this.taunt?1:0},getPoint:function(){return this.getComponent("SlidePoint").point},getCell:function(){return this.getComponent("SlidePoint").cell},getUnitId:function(){return this.unitId},getTeam:function(){return this.team},isMoving:function(){return this.getComponent("UnitMove").isMoving()},isDead:function(){return this.died}}),cc._RFpop()},{}],UnitManager:[function(t,e,n){"use strict";cc._RFpush(e,"1601a7YsAhJCJkAGjU8GOaw","UnitManager");var i=t("CellManager"),r=(t("riddleUtil"),t("underscore")),a=t("UnitConfigManager");cc.Class({"extends":cc.Component,properties:{idCounter:1,idToUnit:{type:Object,visible:!1,"default":null},cellToUnit:{type:Array,visible:!1,"default":null},cellManager:{type:i,visible:!1,"default":null},battleField:{visible:!1,"default":null},unitTemplate:cc.Prefab,unitConfigManager:{type:a,"default":null},keyUnitId:{visible:!1,"default":null}},onLoad:function(){},initByNode:function(t){this.battleField=t,this.cellManager=t.cellManager,this.idToUnit={};var e=this.cellManager.cellRange;this.cellToUnit=new Array(e.x);for(var n=0;n<e.x;n++)this.cellToUnit[n]=new Array(e.y);this.keyUnitId={},this.initWithUnitConfig()},initByTest:function(){},initWithUnitConfig:function(){for(var t=this.cellManager.cellRange,e=0;e<t.x;e++)for(var n=0;n<t.y;n++){var i=cc.p(e,n),r=this.unitConfigManager.getUnitConfigAt(i);r&&(r.cell=i,this.createUnit(r))}this.unitConfigManager.hideConfigLayer()},createUnit:function(t){var e=t.cell,n=this.idCounter++;t.unitId=n;var i=cc.instantiate(this.unitTemplate);return this.idToUnit[n]=i,this.cellToUnit[e.x][e.y]=i,i.getComponent("UnitBase").initByUnitManager(this,t),this.node.addChild(i,0,n),t.key&&(this.keyUnitId[n]=n),i},canMove:function(t){var e=this.unit$(t);return!r.isObject(e)},unitChangeCell:function(t,e,n){this.cellToUnit[e.x][e.y]=void 0,this.cellToUnit[n.x][n.y]=t},unitDead:function(t){var e=t.getComponent("UnitBase").unitId,n=t.getComponent("SlidePoint").cell;this.cellToUnit[n.x][n.y]=void 0,delete this.idToUnit[e],t.removeFromParent(),r.has(this.keyUnitId,e)&&(delete this.keyUnitId[e],0==r.size(this.keyUnitId)&&this.battleField.gameWin())},unit$:function(t,e){if(1==arguments.length)return r.isString(t)||r.isNumber(t)?this.idToUnit[t]:r.isObject(t)?this.unit$(t.x,t.y):null;if(2==arguments.length){var n=this.cellToUnit[t];return r.isArray(n)?n[e]:null}return null},unitInter$:function(t,e){var n=this.unit$.apply(this,arguments);return n?n.getComponent("UnitInter"):void 0}}),cc._RFpop()},{CellManager:"CellManager",UnitConfigManager:"UnitConfigManager",riddleUtil:"riddleUtil",underscore:1}],UnitMove:[function(t,e,n){"use strict";cc._RFpush(e,"d1b2bc0McpAH6ooBrjcgt+V","UnitMove");var i=(t("UserInputList"),t("UserInput").InputObject,t("UserInput").InputType),r=(t("UnitSkill"),t("SlidePoint"),t("UnitAttributes"),t("CellManager"),t("UnitBase"),t("riddleUtil")),a=t("underscore"),l=2;cc.Class({"extends":cc.Component,properties:{timeSum:0,updateTimeSlice:.02,userInputList:{visible:!1,get:function(){return this.getComponent("UserInputList")}},unitSkill:{visible:!1,get:function(){return this.getComponent("UnitSkill")}},slidePoint:{visible:!1,get:function(){return this.getComponent("SlidePoint")}},unitAttr:{visible:!1,get:function(){return this.getComponent("UnitAttributes")}},_moveFlag:{visible:!1,"default":!1},moveFlag:{visible:!1,get:function(){return this._moveFlag},set:function(t){this._moveFlag!=t&&(this._moveFlag?this.startStand():this.startMove(),this._moveFlag=t)}},unitBase:{visible:!1,get:function(){return this.getComponent("UnitBase")}},oper:{visible:!1,"default":null}},onLoad:function(){this.userInputList.clear()},startMove:function(){console.log("start move"),this.unitSkill.unitStartMove()},startStand:function(){console.log("start stand"),this.unitSkill.unitStartStand()},onStartOper:function(t){this.oper=t},cancelOper:function(){this.oper=null},deadCancel:function(){this.oper&&(this.oper.onUnitCancel(),this.cancelOper())},updateCancel:function(t){a.isObject(this.oper)&&(this.oper.onUnitCancel(),this.cancelOper()),this.userInputList.clear(),this.updateStand(t)},updateStand:function(t){var e=t*this.unitAttr.getSpeed(),n=this.slidePoint;n.moveSelfCell(n.cell,e),n.canStand()?this.moveFlag=!1:this.moveFlag=!0,this.slidePoint.updatePosition()},updateMove:function(t,e,n){this.moveFlag=!0;var o=this.slidePoint,s=o.cellFarFrom(t.cell),u=n*this.unitAttr.getSpeed();if(0==s){if(this.userInputList.shift(),!a.isObject(e))return void this.updateStand(n);if(e.type==i.OPER)return void this.updateStand(n);if(e.type==i.MOVE){if(!this.unitBase.cellManager.canMove(e.cell))return void this.updateStand(n);o.moveNearCell(e.cell,u)}}else if(1==s)o.moveNearCell(t.cell,u);else{if(!(s>=2&&l>=s))return void this.updateCancel(n);var c=this.unitBase.cellManager,h=r.shortestPath(o.cell,t.cell,function(t){return c.canMove(t)});if(!(h.length>=2&&h.length<=l+1))return void this.updateCancel(n);o.moveNearCell(h[1],u)}this.slidePoint.updatePosition()},updateOper:function(t,e,n){this.slidePoint.canStand()?(this.unitSkill.unitHit(t),this.userInputList.shift()):this.updateStand(n)},update:function(t){this.sliceUpdate(t)},sliceUpdate:function(t){if(this.unitBase.initFinished){if(this.unitSkill.isAttacking()){var e=this.userInputList.getCurrentInput(),n=this.userInputList.getNextInput();return void(a.isObject(e)&&e.type==i.OPER&&this.updateOper(e,n,t))}if(this.userInputList.isFinished())return void this.updateStand(t);var e=this.userInputList.getCurrentInput(),n=this.userInputList.getNextInput();if(!a.isObject(e))return void this.updateStand(t);if(e.type==i.MOVE){var r=this.slidePoint.cellFarFrom(e.cell);return r>0&&!this.unitBase.cellManager.canMove(e.cell)?(this.userInputList.shift(),void this.updateStand(t)):void this.updateMove(e,n,t)}return e.type==i.OPER?a.isObject(this.unitBase.unitManager.unit$(e.cell))?void this.updateOper(e,n,t):(this.userInputList.shift(),void this.updateStand(t)):void 0}},isMoving:function(){return this.moveFlag}}),cc._RFpop()},{CellManager:"CellManager",SlidePoint:"SlidePoint",UnitAttributes:"UnitAttributes",UnitBase:"UnitBase",UnitSkill:"UnitSkill",UserInput:"UserInput",UserInputList:"UserInputList",riddleUtil:"riddleUtil",underscore:1}],UnitSkill:[function(t,e,n){"use strict";cc._RFpush(e,"bf6d0Rg+apA642RgXWPsYES","UnitSkill");var i=t("Skill"),r=i.SkillBase,a=t("riddleUtil"),l=(t("underscore"),cc.Class({name:"Listener",properties:{listener:null,callback:null},ctor:function(){this.listener=arguments[0],this.callback=arguments[1]}}));cc.Class({"extends":cc.Component,properties:{timeSum:0,updateTimeSlice:.05,attackFlag:{visible:!1,"default":!1},unitBase:{visible:!1,get:function(){return this.getComponent("UnitBase")}},unitInter:{visible:!1,get:function(){return this.getComponent("UnitInter")}},cellManager:{visible:!1,get:function(){return this.getComponent("UnitBase").cellManager}},unitManager:{visible:!1,get:function(){return this.getComponent("UnitBase").unitManager}},unitMove:{visible:!1,get:function(){return this.getComponent("UnitMove")}},slidePoint:{visible:!1,get:function(){return this.getComponent("SlidePoint")}},initListeners:{type:[l],visible:!1,"default":[]},hitListeners:{type:[l],visible:!1,"default":[]},hurtListeners:{type:[l],visible:!1,"default":[]},updateListeners:{type:[l],visible:!1,"default":[]},startMoveListeners:{type:[l],visible:!1,"default":[]},updateMoveListeners:{type:[l],visible:!1,"default":[]},startStandListeners:{type:[l],visible:!1,"default":[]},updateStandListeners:{type:[l],visible:!1,"default":[]},observeEnemiesListeners:{type:[l],visible:!1,"default":[]},observeFriendsListeners:{type:[l],visible:!1,"default":[]},skillList:{type:[r],"default":[]},targetList:{visible:!1,"default":[]}},addSkill:function(t){this.skillList.push(t),t.bind(this.node)},addListener:function(t,e,n){this[t+"Listeners"].push(new l(e,n))},attackLock:function(){this.attackFlag=!0},attackUnlock:function(){this.attackFlag=!1},isAttacking:function(){return this.attackFlag},canAttack:function(){},triggerListener:function(t,e){for(var n=this[t+"Listeners"],i=0,r=n.length;r>i;i++){var a=[].slice.call(arguments,1);n[i].callback.apply(n[i].listener,a)}},unitInit:function(){this.triggerListener("init")},unitHit:function(t){this.triggerListener("hit",t.targetInter)},unitStartMove:function(){this.triggerListener("startMove")},unitStartStand:function(){this.triggerListener("startStand")},unitHurt:function(t){this.triggerListener("hurt",t)},update:function(t){this.timeSum+=t,this.timeSum>=this.updateTimeSlice&&(this.sliceUpdate(this.timeSum),this.timeSum=0)},observe:function(){for(var t=this.slidePoint.cell,e=this.getComponent("UnitAttributes").observeRange,n=a.radioRange(t,e),i={},r=0,l=n.length;l>r;r++){var o=n[r],s=this.unitManager.unitInter$(o);if(s){if(s.unitId==this.unitBase.unitId)continue;i[s.unitId]=s}}var u=this.targetList.filter(function(t){var e=i.hasOwnProperty(t.unitId);return e?(delete i[t.unitId],!0):!1});for(var c in i){var s=i[c];u.push(s)}this.targetList=u;var h=this.unitInter.team,p=u.filter(function(t){return t.team!=h}).filter(function(t){return t.canBeObserved()});p.length>0&&this.triggerListener("observeEnemies",p);var d=u.filter(function(t){return t.team==h});d.length>0&&this.triggerListener("observeFriends",d)},sliceUpdate:function(t){this.triggerListener("update",t),this.unitMove.isMoving()?this.triggerListener("updateMove",t):this.triggerListener("updateStand",t),this.observe()},createBulletMiddle:function(){var t=this.getComponent("UnitAttributes"),e=(.5+t.observeRange)*this.cellManager.cellSize;return{sourceInter:this.unitInter,point:this.unitInter.getPoint(),harm:t.ap,distance:e}}}),cc._RFpop()},{Skill:"Skill",riddleUtil:"riddleUtil",underscore:1}],UserInputList:[function(t,e,n){"use strict";cc._RFpush(e,"06943p/gvlGeKnCHbbsavJO","UserInputList"),cc.Class({"extends":cc.Component,properties:{inputArray:{visible:!1,"default":[]},currentIndex:{visible:!1,"default":0}},onLoad:function(){this.inputArray=[]},add:function(t){this.inputArray.push(t)},shift:function(){return this.currentIndex>=this.inputArray.length?(this.inputArray=[],null):this.inputArray[this.currentIndex++]},clear:function(){this.inputArray=[],this.currentIndex=0},isFinished:function(){return this.currentIndex>=this.inputArray.length},getCurrentInput:function(){return this.inputArray[this.currentIndex]},getNextInput:function(){return this.inputArray[this.currentIndex+1]}}),cc._RFpop()},{}],UserInput:[function(t,e,n){"use strict";cc._RFpush(e,"05a8d2Mz5dO6ZQPuRKmNazM","UserInput");var i={MOVE:2,OPER:3},r=function(t,e,n){this.type=t,this.cell=e,this.targetInter=n};e.exports={InputType:i,InputObject:r},cc._RFpop()},{}],hitSkills:[function(t,e,n){"use strict";cc._RFpush(e,"9b210laucROcZ+HzXq7HW4O","hitSkills");var i=t("riddleUtil"),r=t("Skill").SkillBase,a=cc.Class({"extends":r,properties:{preTime:.5,startFlag:!1,targetInter:null},cast:function(t){this.unitInter.stealth=!1;var e=this.unitSkill.createBulletMiddle();e.targetInter=t,this.unitBase.bulletManager.skillAttackNoBullet(e)},bind:function(t){this._super.apply(this,arguments),this.unitSkill.addListener("hit",this,this.onUnitHit),this.unitSkill.addListener("update",this,this.onUnitUpdate)},onUnitHit:function(t){i.maDistance(this.unitInter.getCell(),t.getCell())>1||this.unitInter.team!=t.team&&(this.startFlag||(this.unitSkill.attackLock(),this.preTime=.5,this.startFlag=!0,this.targetInter=t))},onUnitUpdate:function(t){this.startFlag&&(this.preTime<=0?(this.cast(this.targetInter),this.startFlag=!1,this.preTime=.5,this.targetInter=null,this.unitSkill.attackUnlock()):this.preTime-=t)}}),l=cc.Class({"extends":r,properties:{preTime:.5,startFlag:!1,targetInter:null},cast:function(t){this.unitInter.stealth=!1;var e=this.unitSkill.createBulletMiddle();e.targetInter=t,this.unitBase.bulletManager.skillCreateTrackBullet(e)},bind:function(t){this._super.apply(this,arguments),this.unitSkill.addListener("hit",this,this.onUnitHit),this.unitSkill.addListener("update",this,this.onUnitUpdate)},onUnitHit:function(t){this.startFlag||(this.unitSkill.attackLock(),this.preTime=.5,this.startFlag=!0,this.targetInter=t)},onUnitUpdate:function(t){this.startFlag&&(this.preTime<=0?(this.cast(this.targetInter),this.startFlag=!1,this.preTime=.5,this.targetInter=null,this.unitSkill.attackUnlock()):this.preTime-=t)}}),o=cc.Class({"extends":r,properties:{},cast:function(){},bind:function(t){this._super.apply(this,arguments),this.unitSkill.addListener("init",this,this.onUnitInit)},onUnitInit:function(){this.unitInter.stealth=!0}});e.exports={HitSkill:a,ShotSkill:l,StealthSkill:o},cc._RFpop()},{Skill:"Skill",riddleUtil:"riddleUtil"}],hurtSkills:[function(t,e,n){"use strict";cc._RFpush(e,"39530uQ4+lCCaVmHYn+cUK0","hurtSkills");var i=t("Skill").SkillBase,r=cc.Class({"extends":i,properties:{preTime:.5,startFlag:!1,targetInter:null},cast:function(t){this.unitInter.stealth=!1;var e=this.unitSkill.createBulletMiddle();e.targetInter=t,t.onHurtByBack(e.sourceInter,e.harm)},bind:function(t){this._super.apply(this,arguments),this.unitSkill.addListener("hurt",this,this.onUnitHurt)},onUnitHurt:function(t){this.cast(t)}});e.exports={HurtSkill:r},cc._RFpop()},{Skill:"Skill"}],moveSkills:[function(t,e,n){"use strict";cc._RFpush(e,"0c0e8cwJelE0Z29vC9t8Pli","moveSkills");var i=t("Skill").SkillBase,r=cc.Class({"extends":i,properties:{coolTime:0},bind:function(){this._super.apply(this,arguments),this.unitSkill.addListener("startMove",this,this.onUnitStartMove),this.unitSkill.addListener("updateMove",this,this.onUnitUpdateMove)},onUnitStartMove:function(){this.coolTime=1},onUnitMoveUpdate:function(t){this.coolTime-=t,this.coolTime<=0&&(this.cast(),this.coolTime=1)}});e.exports={MoveSkill:r},cc._RFpop()},{Skill:"Skill"}],riddleUtil:[function(t,e,n){"use strict";cc._RFpush(e,"dbb10DJJlxHZp3hbAIviWQK","riddleUtil");var i=t("underscore"),r={xyWrap:function(t,e){return e?{x:t,y:e}:t},isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},maDistance:function(t,e){var n=Math.abs;return n(t.x-e.x)+n(t.y-e.y)},euDistance:function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},shortestPath:function(t,e,n){var r=this.maDistance,a={x:t.x,y:t.y},l={x:e.x,y:e.y},o=function(t){return 1e3*t.x+t.y};a.g=0,a.h=r(a,l),a.pre=null;for(var s=0,u=0,c=[a],h=function(){for(var t=c[s],e=s,n=s+1;u>=n;n++){var i=c[n];i.g+i.h<t.g+t.h&&(t=i,e=n)}return e},p={},d=function(t){var e=c[t],a=[{x:e.x+1,y:e.y},{x:e.x-1,y:e.y},{x:e.x,y:e.y+1},{x:e.x,y:e.y-1}];a=i.filter(a,function(t){var i=t.x,r=t.y;return n({x:i,y:r})?!p[o(e)]:!1}),i.each(a,function(t){t.g=e.g+1,t.h=r(t,l),t.pre=e,c.push(t),u++}),c[t]=c[s],c[s]=e,s++,p[o(e)]=e};u>=s;){var f=h(),g=c[f];if(1==g.h){for(var v=[l],y=g;;)if(v.push(y),y=y.pre,null==y)break;return i.map(v.reverse(),function(t){return cc.p(t.x,t.y)})}d(f)}return[]},test:{dosth:function(){var t=this.bulletManager,e=this.unit;return t.unitCreateBullet(e,1)}},radioRange:function(t,e){if(0>=e)return[{x:t.x,y:t.y}];for(var n=[],i=-e;e>=i;i++)n.push({x:t.x,y:t.y+i});for(var r=1;e>=r;r++)for(var i=-(e-r);e-r>=i;i++)n.push({x:t.x+r,y:t.y+i}),n.push({x:t.x-r,y:t.y+i});return n},_:i};e.exports=r,cc._RFpop()},{underscore:1}],skillCategory:[function(t,e,n){"use strict";cc._RFpush(e,"e724d9SSvNJjK5B3UdiUZh5","skillCategory");var i=(t("Skill"),t("hitSkills")),r=t("moveSkills"),a=t("standSkills"),l=t("hurtSkills"),o={HIT:i.HitSkill,SHOT:i.ShotSkill,STAND:a.StandSkill,TRACK_STAND:a.TrackStandSkill,MOVE:r.MoveSkill,STEALTH:i.StealthSkill,HURT:l.HurtSkill};cc.Enum({});e.exports={CategoryToClass:o},cc._RFpop()},{Skill:"Skill",hitSkills:"hitSkills",hurtSkills:"hurtSkills",moveSkills:"moveSkills",standSkills:"standSkills"}],standSkills:[function(t,e,n){"use strict";cc._RFpush(e,"7b5fdzrHuBAWZXAfTc2r9lg","standSkills");var i=t("Skill").SkillBase,r=1,a=cc.Class({"extends":i,properties:{coolTime:r},bind:function(){this._super.apply(this,arguments),this.unitSkill.addListener("startStand",this,this.onUnitStartStand),this.unitSkill.addListener("updateStand",this,this.onUnitUpdateStand),this.unitSkill.addListener("observeEnemies",this,this.onUnitObserveEnemies)},cast:function(t){this.unitInter.stealth=!1;var e=this.unitSkill.createBulletMiddle();e.targetInter=t,this.unitBase.bulletManager.skillCreateStraightBullet(e)},onUnitObserveEnemies:function(t){this.coolTime<=0&&(this.cast(t[0]),this.coolTime=r)},onUnitStartStand:function(){this.coolTime=r},onUnitUpdateStand:function(t){this.coolTime-=t,this.coolTime<=0&&(this.coolTime=0)}}),l=cc.Class({"extends":i,properties:{coolTime:r},bind:function(){this._super.apply(this,arguments),this.unitSkill.addListener("startStand",this,this.onUnitStartStand),this.unitSkill.addListener("updateStand",this,this.onUnitUpdateStand),this.unitSkill.addListener("observeEnemies",this,this.onUnitObserveEnemies)},cast:function(t){this.unitInter.stealth=!1;var e=this.unitSkill.createBulletMiddle();e.targetInter=t,this.unitBase.bulletManager.skillCreateTrackBullet(e)},onUnitObserveEnemies:function(t){this.coolTime<=0&&(this.cast(t[0]),this.coolTime=r)},onUnitStartStand:function(){this.coolTime=r},onUnitUpdateStand:function(t){this.coolTime-=t,this.coolTime<=0&&(this.coolTime=0)}});e.exports={StandSkill:a,TrackStandSkill:l},cc._RFpop()},{Skill:"Skill"}]},{},["TranController","UserInput","UserInputList","FlyPoint","moveSkills","BattleFieldComponent","UnitManager","StraightBullet","GameControl","PanelButton","BulletManager","hurtSkills","UnitInter","Skill","TiledMapAdapter","DrawItem","UnitConfigManager","standSkills","UnitBase","CnText","hitSkills","BulletBase","InputController","UnitSkill","TrackBullet","CellManager","DrawLayer","UnitAttributes","UnitMove","UnitCategory","BasePoint","SlidePoint","riddleUtil","skillCategory"]);